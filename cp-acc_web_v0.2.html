<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<title>{{Title}}</title>

	<meta name="description" content="">
	<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
*,*:after,*:before{
	-webkit-box-sizing:border-box;
	-moz-box-sizing:border-box;
	box-sizing:border-box;
}
html,body{
	width: 375px; /* Web */
	/*width: 316px; Wix */
	height:100%;
}
body{
	margin:0;
	padding:0;
	position:relative;
	background:#22142b;
	/*width: 341px; /*dynamically*/
	/*height: 511px; /*dynamically*/
	/*margin-left: auto;*/
  	/*margin-right: auto;*/
  	width: 375px; /* Web */
	/*width: 316px; Wix */
	overflow-y: scroll; /* Hide vertical scrollbar */
  		overflow-x: scroll; /* Hide horizontal scrollbar */
		scrollbar-width: none; /* Firefox */
		-ms-overflow-style: none;  /* IE 10+ */
}

::-webkit-scrollbar { /* WebKit */
		width: 0px;
		background:transparent;
	  	display: none;
	}

h3{
	font-size: 25px;
	font-weight: bold;
	font-family: serif;
	color: #ECF0F1;
	text-align: center;
}

h6#skin_tag{
	font-size: 10px;
	font-weight: bold;
	font-family: serif;
	text-align: center;
	position:absolute;
	border-radius: 10px;
	border: 1.25px solid #FFF;
	top:50px;
	left:10px;
	display:block;
	margin:0;
	padding:0;
	width:50px;
	height:15px;
	background-color: black;
	color: white;
	z-index: 3;
}

h6#hair_tag{
	font-size: 10px;
	font-weight: bold;
	font-family: serif;
	text-align: center;
	position:absolute;
	border-radius: 10px;
	border: 1.25px solid #FFF;
	top:110px;
	left:10px;
	display:block;
	margin:0;
	padding:0;
	width:50px;
	height:15px;
	background-color: black;
	color: white;
	z-index: 3;
}

h6#eye_tag{
	font-size: 10px;
	font-weight: bold;
	font-family: serif;
	text-align: center;
	position:absolute;
	border-radius: 10px;
	border: 1.25px solid #FFF;
	top:170px;
	left:10px;
	display:block;
	margin:0;
	padding:0;
	width:50px;
	height:15px;
	background-color: black;
	color: white;
	z-index: 3;
}

.zoomable {
	margin: 0px;
	z-index: -1;
}


.thumbnail {
	position:relative;
	display: inline-block;
	/*width: 341px; /*dynamically*/
	/*height: 511px; /*dynamically*/
	margin-left: auto;
  	margin-right: auto;
	overflow:hidden;
	z-index: 0;
}

.thumbnail img {
	z-index: 0;
	cursor: crosshair;
}

.thumnail canvas {
	z-index: 0;
}

#upload {
  display: block;
  margin-left: auto;
  margin-right: auto;
  /* border: 2.5px solid; */
}

.result{
	position: fixed;
	top: 0;
	left: 0;
	background: #000;
	background: rgba(0, 0, 0, 0.2);
	color: #fff;
	margin: 0;
	padding: 10px 15px;
	display: block;
}
.result span {
	display: block;
	font-size: 13px;
}
/*.preview{
	position:absolute;
	top:5px;
	right:5px;
	display:block;
	margin:0;
	padding:0;
	width:50px;
	height:50px;
	border: 5px solid #FFF;
	border-right: none;
	border-top: none;
}*/
/*

style.backgroundRepeat
style.backgroundSize
style.backgroundPosition
style.backgroundColor

*/
.preview_skin{
	position:absolute;
	background: transparent url("https://static.wixstatic.com/media/3e929c_000c0389ad654985be5d7983694c7695~mv2.png") no-repeat center 50%;
	background-size: 42.5px 42.5px;
	border-radius: 50%;
	top:10px;
	left:10px;
	display:block;
	margin:0;
	padding:0;
	width:50px;
	height:50px;
	border: 5px solid #FFF;
	z-index: 2;
}
.preview_hair{
	position:absolute;
	/*background: transparent url("https://static.wixstatic.com/media/3e929c_140376a5ca764b5b8bfaec84b8032331~mv2.png") no-repeat center 50%;*/
	background: transparent url("https://static.wixstatic.com/media/3e929c_cad76816bc4441b6bfe34f5008b2741d~mv2.png") no-repeat center 50%;
	background-size: 42.5px 42.5px;
	border-radius: 50%;
	top:70px;
	left:10px;
	display:block;
	margin:0;
	padding:0;
	width:50px;
	height:50px;
	border: 5px solid #FFF;
	z-index: 2;
}
.preview_eye{
	position:absolute;
	/*background: transparent url("https://static.wixstatic.com/media/3e929c_611fc87912204e21a75a1251bc38467a~mv2.png") no-repeat center 50%;*/
	/*background: rgb(80,67,71) url("https://static.wixstatic.com/media/3e929c_1e3a8bb1dea541a7a290ec79329fa2f1~mv2.png") no-repeat center 50%;*/
	background: transparent url("https://static.wixstatic.com/media/3e929c_f628dfa5fe0a412da6f06954a8657458~mv2.png") no-repeat center 50%;
	background-size: 45px 45px;
	border-radius: 50%;
	top:130px;
	left:10px;
	display:block;
	margin:0;
	padding:0;
	width:50px;
	height:50px;
	border: 5px solid #FFF;
	z-index: 2;
}
.reset{
	position: absolute;
	/*background: url("https://static.wixstatic.com/media/e3157a_ed2814b14577454c93c57b77ab73c492~mv2.png");*/
	background: white url("https://static.wixstatic.com/media/3e929c_c8c6449b47974b5da98157f0f1d950b7~mv2.png") no-repeat center 50%;
	background-size: 30px 30px;
	border-radius: 50%;
	bottom:10px;
	left:10px;
	display:block;
	margin:0;
	padding:0;
	width:50px;
	height:50px;
	border: 5px solid #FFF;
	z-index: 100;
	/*background-color: black;
	color: white;
	background-color:transparent;*/
}
.gesture_tap{
	position: absolute;
	/*background: url("https://static.wixstatic.com/media/e3157a_ed2814b14577454c93c57b77ab73c492~mv2.png");*/
	background: transparent url("https://static.wixstatic.com/media/3e929c_d124958d799749318d9122389c4cfb88~mv2.png") no-repeat center 45%;
	background-size: 35px 35px;
	background-color: white;
	border-radius: 50%;
	top:10px;
	right:10px;
	display:block;
	margin:0;
	padding:0;
	width:50px;
	height:50px;
	border: 5px solid #FFF;
	z-index: 100;
	/*background-color: black;
	color: white;
	background-color:transparent;*/
}
.gesture_spread{
	position: absolute;
	/*background: url("https://static.wixstatic.com/media/e3157a_ed2814b14577454c93c57b77ab73c492~mv2.png");*/
	background: transparent url("https://static.wixstatic.com/media/3e929c_34e19190f10e4eaeb973bf4d81800845~mv2.png") no-repeat center 50%;
	background-size: 35px 35px;
	background-color: white;
	border-radius: 50%;
	top:70px;
	right:10px;
	display:block;
	margin:0;
	padding:0;
	width:50px;
	height:50px;
	border: 5px solid #FFF;
	z-index: 100;
	/*background-color: black;
	color: white;
	background-color:transparent;*/
}
.icon_delete {
	  position: absolute;
	  top: -7.5px;
	  /*left: 20px;*/
	  right: -8px;
	  display: flex;
	  align-items: center;
	  justify-content: center;
	  z-index: 1;
	}
.preview_debug{
	position:absolute;
	border-radius: 50%;
	top:190px;
	left:10px;
	display:block;
	margin:0;
	padding:0;
	width:50px;
	height:50px;
	border: 5px solid #FFF;
	z-index: 100;
}
.preview_debug_2{
	position:absolute;
	border-radius: 50%;
	top:250px;
	left:10px;
	display:block;
	margin:0;
	padding:0;
	width:50px;
	height:50px;
	border: 5px solid #FFF;
	z-index: 100;
}
.preview_debug_3{
	position:absolute;
	border-radius: 10px;
	border: 1.25px solid #FFF;
	top:20px;
	left:75px;
	display:block;
	margin:0;
	padding:0;
	width:191px;
	height:25px;
	background-color: black;
	color: white;
	z-index: 100;
}
.message{
	position: absolute;
	border-radius: 20px;
	border: 5px solid #FFF;
	bottom:15px;
	left:75px;
	right:75px;
	display:block;
	margin:0;
	padding:0;
	width: auto;
	height: 35px;
	background-color: white;
	color: black;
	z-index: 100;
	text-align: center;
	padding: 2.5px;
}
.color_picker{
	position:absolute;
	border-radius: 50%;
	top:10px;
	right:10px;
	display:block;
	margin:0;
	padding:0;
	width:50px;
	height:50px;
	border: 2.5px solid #fff;
	z-index: 1;
	display: flex;
  	justify-content: center;
}
#cs{ 
	display:none;
}
#cp_image{
	margin-top: 6.25px;
}
#eye_image{
	margin-top: 10.90px;
}
#hair_image{
	margin-top: 1px;
	margin-left: 1.5px;
}
#skin_image{
	margin-left: 2px;
}
/*@media (min-width:768px){
	.thumbnail{
		width:85%;
	}
}
@media (min-width:1024px){
	.thumbnail{
		width:55%;
	}
}*/
/*@media (max-width:512px){
	.thumbnail{
		width:85%;
	}
}
@media (min-width:512px){
	.thumbnail{
		width:55%;
	}
}*/

/* https://css-tricks.com/scaled-proportional-blocks-with-css-and-javascript/ */
</style>
<script>
	var inst = {};
	var _listener1;
	var _listener2;
	var _listener3;
	var _listener4;
	var skinSelection = false;
	var hairSelection = false;
	var eyeSelection = false;
	var pan = false;
	var zoom = false;
	var transform = false;
	var activateCP = false;
	var tf;
	var isMobile;
	var tlength;
	var cpsig1 = "";
	var cpsig2 = "";
	var instance;
</script>


</head>

<!-- <body onload="init()"> -->
<body>
<!-- <body onload="init()"> -->
	<!-- {{Body}} -->




<!-- <h1 style="color:#fff;" align="center">Color Picker</h1> -->

<!-- <div class="container">
	<div class="wrapper">
		<div class="items">
			<div class="item" id="eye" onclick="activateColorPicker1(this.id)">Eye</div>	
			<div class="item" id="hair" onclick="activateColorPicker1(this.id)">Hair</div>
			<div class="item" id="skin" onclick="activateColorPicker1(this.id)">Skin</div>
		</div>
	</div>
</div>-->
<!-- <div class="flyout-debug" id="flyout-debug"></div> -->
<!-- <button class="preview_test" id="preview_test"></button> -->
<div class="thumbnail">
	<img id="upload" alt="" src="">
</div> 
<!-- <div class="result">
	<span>HEX: <strong id="hex"></strong></span>
	<span>RGB: <strong id="rgb"></strong></span>
</div> -->

<script type="text/javascript">

// Wix/iFrame messaging

/*window.addEventListener('message', async function(event) { //https://javascript.info/cross-window-communication#onmessage
    console.log("Let's see if we received a message...");
    if (event.data){
		var str = event.data;
		console.log("Message received from Wix!"); //Message received indicates a button click was received.
		console.log("event.origin: ", event.origin);
		console.log("event.data: ", event.data);
		//port = e.ports[0];
		console.log("event.ports: ", event.ports);
		var obj = JSON.parse(event.data);
		console.log(obj);
		//we might receive an image URL
		if(obj.type === "displayImage"){
			console.log("URL = " + obj.url);
			var dataUrl = await getDataUrl(obj.url);
			console.log(dataUrl)
			addBase64Image(dataUrl);
			//Enable color picker
			enableCP();
			//
			// ---
			//var newMessage = document.createElement('div'); 
			//newMessage.className = 'message';
			//newMessage.id = 'message';
			//document.querySelector('body').insertBefore(newMessage, document.querySelector('body').children[1]);
			// ---
	    //we might receive a request to navigate to the next slide
	    } else if (obj.type === "getAnswer") {
	    	console.log("getAnswer();")

	    	var response = getAnswer();
	    	console.log(response);
	      	var response_json = JSON.stringify(response);

	      	//SendResponse
	      	//var receiver = "https://www.thefashionsociety.eu";
	      	var receiver = "https://yvervoort.wixsite.com/";
	      	window.parent.postMessage(response_json,receiver);
			console.log("--- [iFrame]: NL ---");


	    //we might receive a request to delete the image
		} else if (obj.type === "removeImage") {
	    	document.getElementById("upload").remove();
	    	
	    	//perform a full reset
			for (var child of document.getElementsByClassName("thumbnail")[0].childNodes) {
				console.log(child);
			    child.remove();
			}
			for (var child of document.getElementsByClassName("thumbnail")[0].childNodes) {
				console.log(child);
			    child.remove();
			}
			for (var child of document.getElementsByClassName("thumbnail")[0].childNodes) {
				console.log(child);
			    child.remove();
			}
			document.getElementsByClassName("thumbnail")[0].removeAttribute("tabindex");
			document.getElementsByClassName("thumbnail")[0].removeAttribute("style");

			addDiv = document.createElement('img'); 
			addDiv.setAttribute("id","upload");
			addDiv.setAttribute("alt","");
			addDiv.setAttribute("src","");
			//document.getElementById("upload").src = "";
			document.getElementsByClassName("thumbnail")[0].appendChild(addDiv);


	    } else {

	    }
    } else {
    	console.log("Issue...");
    }
});*/


function getAnswer() {

	var res = JSON.parse('{}');

	//Perform a check to see whether a skin, hair and eye color was assigned by the user
	//console.log("skinSelection = ", skinSelection);
	//console.log("hairSelection = ", hairSelection);
	//console.log("eyeSelection = ", eyeSelection);

	// -- 
	// REWRITE
	// --
	var nbChildren = document.getElementsByClassName("thumbnail")[0].children.length;
	//console.log(nbChildren);
	for(i=0;i<nbChildren;i++){
		//console.log("Preview?");
		//console.log(document.getElementsByClassName("thumbnail")[0].children[i].className.includes("preview"));
		if(document.getElementsByClassName("thumbnail")[0].children[i].className.includes("preview")){
			if(document.getElementsByClassName("thumbnail")[0].children[i].className.includes("skin") && skinSelection === true){
				res.skin = document.getElementById("preview_skin").style.background;
			} else {
				res.skin = "";
			}
			if (document.getElementsByClassName("thumbnail")[0].children[i].className.includes("hair") && hairSelection === true) {
				res.hair = document.getElementById("preview_hair").style.background;
			} else {
				res.hair = "";
			}
			if (document.getElementsByClassName("thumbnail")[0].children[i].className.includes("eye") && eyeSelection === true) {
				res.eye = document.getElementById("preview_eye").style.background;
			} else {
				res.eye = "";
			}
		}
	}

	//console.log("After loop result:")
	//console.log(res)

	return res;		
}



</script>


<script type="text/javascript">

async function init() {

	//await addHTML();

	//pixel data
	//console.log("Platform = ", navigator.platform);
	//console.log("User agent = ", navigator.userAgent);


	isMobile = {
	    Android: function() {
	        return navigator.userAgent.match(/Android/i);
	    },
	    BlackBerry: function() {
	        return navigator.userAgent.match(/BlackBerry/i);
	    },
	    iOS: function() {
	        return navigator.userAgent.match(/iPhone|iPad|iPod/i);
	    },
	    Opera: function() {
	        return navigator.userAgent.match(/Opera Mini/i);
	    },
	    Windows: function() {
	        return navigator.userAgent.match(/IEMobile/i);
	    },
	    any: function() {
	        return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
	    }
	};

	if(isMobile.any()){
	    // Mobile!
	    console.log("Mobile!");
	} else {
	    // Not mobile
	    console.log("Desktop!");
	}

	//pixel data
	/*
	console.log("Screen width in pixels = ", window.screen.width); //The screen.width property returns the width of the visitor's screen in pixels.
    console.log("Screen height in pixels = ", window.screen.height);
    console.log("= ", window.screen.width * window.devicePixelRatio);
    console.log("= ", window.screen.height * window.devicePixelRatio);
    console.log("Viewport Width= ", window.innerWidth);
    console.log("Viewport Height= ", window.innerHeight);
    console.log("Viewport Width= ", window.outerWidth);
    console.log("Viewport Height= ", window.outerHeight);
    console.log("(Inner) Viewport Width= ", document.body.clientWidth);     // El. width minus scrollbar width
	console.log("(Inner) Viewport Width= ", document.body.scrollWidth);     // El. width minus scrollbar 
	console.log("(Inner) Viewport Height= ", document.body.clientHeight);     // El. width minus scrollbar width
	console.log("(Inner) Viewport Height= ", document.body.scrollHeight);     // El. width minus scrollbar width
	*/

	//getDataUrl
  	var dataUrl = await getDataUrl("https://static.wixstatic.com/media/6068b5_5888cb03ab9643febc221f3e6788d656~mv2.jpg");
  	//console.log(dataUrl);
  	//Create new image on body tag with dataurl
  	await addBase64Image(dataUrl);
  	await addCanvas();
  	//console.log("canvas");
  	//console.log(canvas)
  	await enableEHSicons();
  	//enableCP();

}

function addHTML(){

	var div = document.createElement("div");
	div.className = "thumbnail";
	var body = document.getElementsByTagName('body')[0];
	body.appendChild(div);

	var img = document.createElement("img");
	img.src = "data:,";
	img.id = "upload";
	var tn = document.getElementsByClassName("thumbnail")[0]
	tn.appendChild(img);

}

function addCanvas(){

	//console.log("addCanvas")

	var img_upload = document.getElementById('upload');
	img_upload.className = "zoomable";

	//make zoomable
	var area = document.querySelector('.zoomable')
	
	//activate panzoom
	instance = panzoom(area, {
	  zoomDoubleClickSpeed: 1, //When double clicking, zoom is multiplied by zoomDoubleClickSpeed, which means that a value of 1 will disable double click zoom completely.
	  disablePan: false,
	  disableZoom: false,
	  maxZoom: 20,
	  minZoom: 1, //enable zoom-out after zoom-in only
	  bounds: true,
	  boundsPadding: 1
	});

	instance.on('panstart', function(e) {
	  //console.log('Fired when pan is just started ', e);
	  // Note: e === instance.
	  //document.getElementsByClassName("preview_debug_2")[0].innerText = "PS";
	  cpsig2 = cpsig2 + "PS";
	  pan = true;
	});

	instance.on('pan', function(e) {
	  //console.log('Fired when the `element` is being panned', e);
	  //document.getElementsByClassName("preview_debug_2")[0].innerText = "P";
	  cpsig2 = cpsig2 + "P";
	  pan = true;
	});

	instance.on('panend', function(e) {
	  //console.log('Fired when pan ended', e);
	  //document.getElementsByClassName("preview_debug_2")[0].innerText = "PE";
	  cpsig2 = cpsig2 + "PE";
	  pan = false;
	});

	instance.on('zoom', function(e) {
	  //console.log('Fired when `element` is zoomed', e);
	  //document.getElementsByClassName("preview_debug_2")[0].innerText = "Z";
	  zoom = true;
	});

	instance.on('zoomend', function(e) {
	  //console.log('Fired when zoom animation ended', e);
	  zoom = false;
	  //document.getElementsByClassName("preview_debug_2")[0].innerText = "ZE";
	});

	instance.on('transform', function(e) {
  		// This event will be called along with events above.
  		//console.log('Fired when any transformation has happened', e);
  		tf = instance.getTransform();
  		//tf.x < 1E6 is considered to be 0
  		//tf.y  < 1E6 is considered to be 0
  		//scale = 1 is considered no zoom
  		//document.getElementsByClassName("preview_debug_3")[0].innerText = "x: " + tf.x + " - y: " + tf.y + " - scale: " + tf.scale + "";
  		//document.getElementsByClassName("preview_debug_3")[0].innerText = "scale: " + tf.scale + "";

  		if((tf.x > -1E-9 || tf.x < 1E-9) && (tf.y > -1E-9 || tf.y < 1E-9) && tf.scale === 1) {
  			//document.getElementsByClassName("preview_debug_3")[0].innerText = "NO TF!";
  		} else {
			transform = true;
			//document.getElementsByClassName("preview_debug_3")[0].innerText = "TF: " + transform.toString();
			//document.getElementsByClassName("preview_debug_3")[0].innerText = "x: " + tf.x + " - y: " + tf.y + " - scale: " + tf.scale + "";
  			
  		}
	});

	inst.img = img_upload; //is this assignment causing the issue?
	//console.log(inst.img);

	inst.canvas = document.createElement('canvas');
	inst.img.parentNode.insertBefore(inst.canvas, inst.img.nextSibling);
	inst.canvas.style.display = 'none';

	// default first pixel canvas
	useCanvas(inst.canvas, inst.img, function(){
		// console.log('first init');
	});
	inst.img.addEventListener("click", _listener1, false);
	inst.img.addEventListener("touchend", _listener2, false);
	inst.img.addEventListener("mousemove", _listener3, false);
	inst.img.addEventListener("touchmove", _listener4, false);
}

// check img resize
function checkCanvasSize(el, image){
	return el.width == image.width && el.height == image.height;
}

// canvas function
function useCanvas(el, image, callback){
	console.log("useCanvas")
	console.log(image);
	//https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage
	//console.log(el.width);
	//console.log(el.height);
	if(!checkCanvasSize(el, image)){
		console.log("checkCanvasSize")
		el.width = image.width; // img width
		el.height = image.height; // img height

		console.log(el.width);
		console.log(el.height);
		
		// draw image in canvas tag - void ctx.drawImage(image, dx, dy, dWidth, dHeight);
		el.getContext('2d').drawImage(image, 0, 0, image.width, image.height);
		console.log(el)
		console.log(el.getContext('2d'))
	} else {
		console.log("else ...")
		console.log(image.style.transform)
		//if no transformation - do nothing
		//if transformation - do "something"
		if(image.style.transform !== "matrix(1, 0, 0, 1, 0, 0)"){
			//- draw transformed image onto canvas
			el.getContext('2d').drawImage(image, 0, 0, image.width, image.height);
		}
	}
	return callback();
}

// short querySelector
function _(el){
	return document.querySelector(el);
};

function enableCP(){

	//build array of clicked items
	obj = JSON.parse('{"colors": [{"description" : "eye","values": {"red": -1,"green": -1,"blue": -1}},{"description" : "hair","values": {"red": -1,"green": -1,"blue": -1}},{"description" : "skin","values": {"red": -1,"green": -1,"blue": -1}}]}');

	//activate color picker for skin (easiest)
	enableEHSicons("skin");
	activateColorPicker1("skin");
}

init();

</script>

<script type="text/javascript">
// Base64 conversion

function getImageDimensions(file) {
  return new Promise(function(resolved, rejected) {
    var i = new Image()
    i.onload = function() {
      resolved({
        w: i.width,
        h: i.height
      })
    };
    i.src = file
  })
}

async function getDataUrl(img_url) {
  // Create canvas
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');

  var dimensions = await getImageDimensions(img_url);
  //console.log(dimensions);

  // Set width and height
  canvas.width = dimensions.w; //img_url.width
  canvas.height = dimensions.h; //img_url.height

  //console.log("canvas dimensions");
  //console.log(canvas.width)
  //console.log(canvas.height)

  var res = await loadImage(ctx, img_url, dimensions.w, dimensions.h);
  //console.log("res = ", res);

  ctx.drawImage(res, 0, 0);
  //console.log(canvas);
  //console.log(ctx);

  dataurl = canvas.toDataURL('image/png');

  return dataurl;
}

function loadImage(context, path, dimx, dimy) {
  return new Promise(function(resolve, reject) {
    var img = new Image();
    img.onload = function() {
      resolve.call(null, img);
    };
    img.setAttribute('crossorigin', 'anonymous');
    img.src = path;

  });
}

function calculateAspectRatioFit(srcWidth, srcHeight, maxWidth, maxHeight) {
  var ratio = Math.min(maxWidth / srcWidth, maxHeight / srcHeight);
  return {
    width: srcWidth * ratio,
    height: srcHeight * ratio
  };
}

async function addBase64Image(img_dataurl) {
	var dimensions = await getImageDimensions(img_dataurl);
	console.log("debug - dimensions:")
	console.log(dimensions);
	/*if(isMobile.any()){
		var res = calculateAspectRatioFit(dimensions.w, dimensions.h, 310, 310); //mobile
	} else {
		var res = calculateAspectRatioFit(dimensions.w, dimensions.h, 512, 512); //desktop
	}*/
	//console.log(res);
	var res = calculateAspectRatioFit(dimensions.w, dimensions.h, 375, 812);

	//append image (New)
	document.body.style.background = "#ffffff";
	var image = document.getElementById('upload');
	console.log("debug - image:")
	console.log(image)
	image.width = res.width;
	image.height = res.height;
	image.src = img_dataurl;

	document.getElementsByTagName('body')[0].style.width = image.width + "px";
	document.getElementsByTagName('body')[0].style.height = image.height + "px";
	document.getElementsByClassName('thumbnail')[0].style.width = image.width + "px";
	document.getElementsByClassName('thumbnail')[0].style.height = image.height + "px";

}


</script>
<script src='https://unpkg.com/panzoom@8.7.5/dist/panzoom.min.js'></script>


<script>

    var obj;

	function enableEHSicons() {

			//show icons on the left
			var newDiv = new Array(7);

			newDiv[0] = document.createElement('button'); 
			newDiv[0].className = 'preview_skin';
			newDiv[0].id = 'preview_skin';

			document.querySelector('body').insertBefore(newDiv[0], document.querySelector('body').children[1]);

			var ps = document.querySelector("button#preview_skin")
			ps.addEventListener("click", function(){
    			activateEHSPicker(this.id);
    			//document.getElementsByClassName("flyout-debug")[0].innerText = "CP added";
			}, false);

			
			newDiv[1] = document.createElement('button'); 
			newDiv[1].className = 'preview_hair';
			newDiv[1].id = 'preview_hair';

			document.querySelector('body').insertBefore(newDiv[1], document.querySelector('body').children[2]);
			
			var ph = document.querySelector("button#preview_hair")
			ph.addEventListener("click", function(){
    			activateEHSPicker(this.id);
    			//document.getElementsByClassName("flyout-debug")[0].innerText = "CP added";
			}, false);


			newDiv[2] = document.createElement('button'); 
			newDiv[2].className = 'preview_eye';
			newDiv[2].id = 'preview_eye';

			document.querySelector('body').insertBefore(newDiv[2], document.querySelector('body').children[3]);

			var pe = document.querySelector("button#preview_eye")
			pe.addEventListener("click", function(){
    			activateEHSPicker(this.id);
    			//document.getElementsByClassName("flyout-debug")[0].innerText = "CP added";
			}, false);
			

			


			/*var pt = document.querySelector("button#preview_test")
			pt.addEventListener("click", function(){
    			document.getElementsByClassName("flyout-debug")[0].innerText = "CP added";
			}, false);*/

			/*newDiv[3] = document.createElement('button'); 
			newDiv[3].className = 'preview_debug';
			newDiv[3].id = 'preview_debug';
			//newDiv[2].setAttribute("onclick","activateEHSPicker(this.id)");
			//document.getElementsByClassName('thumbnail')[0].insertBefore(newDiv[2], document.getElementsByClassName('thumbnail')[0].children[3]);
			//document.getElementById('preview_skin').style.cursor = "pointer";

			document.querySelector('body').insertBefore(newDiv[3], document.querySelector('body').children[4]);*/

			//newDiv[4] = document.createElement('button'); 
			//newDiv[4].className = 'preview_debug_2';
			//newDiv[4].id = 'preview_debug_2';
			//newDiv[2].setAttribute("onclick","activateEHSPicker(this.id)");
			//document.getElementsByClassName('thumbnail')[0].insertBefore(newDiv[2], document.getElementsByClassName('thumbnail')[0].children[3]);
			//document.getElementById('preview_skin').style.cursor = "pointer";

			//document.querySelector('body').insertBefore(newDiv[4], document.querySelector('body').children[5]);

			newDiv[5] = document.createElement('div'); 
			newDiv[5].className = 'preview_debug_3';
			newDiv[5].id = 'preview_debug_3';
			document.querySelector('body').insertBefore(newDiv[5], document.querySelector('body').children[1]);

			newDiv[6] = document.createElement('button'); 
			newDiv[6].className = 'reset';
			newDiv[6].id = 'reset';
			document.querySelector('body').insertBefore(newDiv[6], document.querySelector('body').children[6]);

			var pr = document.querySelector("button#reset")
			pr.addEventListener("click", _reset, false);


			/*var pt = document.querySelector("button#preview_test")
			pt.addEventListener("click", function(){
    			document.getElementsByClassName("flyout-debug")[0].innerText = "CP added";
			}, false);*/

			var newGesture1 = document.createElement('button'); 
			newGesture1.className = 'gesture_tap';
			newGesture1.id = 'gesture_tap';
			document.querySelector('body').insertBefore(newGesture1, document.querySelector('body').children[1]);

			var gt = document.querySelector("button#gesture_tap")
			gt.addEventListener("click", _gesturet, false);

			var newGesture2 = document.createElement('button'); 
			newGesture2.className = 'gesture_spread';
			newGesture2.id = 'gesture_spread';
			document.querySelector('body').insertBefore(newGesture2, document.querySelector('body').children[1]);

			var gs = document.querySelector("button#gesture_spread")
			gs.addEventListener("click", _gestures, false);



			var h = document.createElement("H6");
			h.id = "skin_tag"
  			var t = document.createTextNode("SKIN");
  			h.appendChild(t);
  			document.querySelector('body').insertBefore(h, document.querySelector('body').children[3]);

  			var h = document.createElement("H6");
  			h.id = "hair_tag"
  			var t = document.createTextNode("HAIR");
  			h.appendChild(t);
  			document.querySelector('body').insertBefore(h, document.querySelector('body').children[5]);

  			var h = document.createElement("H6");
  			h.id = "eye_tag"
  			var t = document.createTextNode("EYE");
  			h.appendChild(t);
  			document.querySelector('body').insertBefore(h, document.querySelector('body').children[7]);
			
	}

	function activateEHSPicker(id) {

		//perform a check whether another EHS picker was already activated --> de-activate

		//console.log("Color picker activated through click...")
		//document.getElementsByClassName("flyout-debug")[0].innerText = "CP activated";

		switch(id) {
		  case "preview_eye":
		  	//check whether another was activated or not
		  	if(!((document.getElementById('preview_skin').style.border === "5px solid #000" || document.getElementById('preview_skin').style.border === "5px solid rgb(0, 0, 0)") || (document.getElementById('preview_hair').style.border === "5px solid #000" || document.getElementById('preview_hair').style.border === "5px solid rgb(0, 0, 0)"))){ //black
			  	//check whether already activated or not
			  	if(document.getElementById('preview_eye').style.border === "" || document.getElementById('preview_eye').style.border === "5px solid #fff" || document.getElementById('preview_eye').style.border === "5px solid rgb(255, 255, 255)"){ //white
			  		//only allow adjustment when preview_eye, preview_hair and preview_skin were already set
			  		if(skinSelection === true && hairSelection === true && eyeSelection === true){ 
				  		//activate
				  		document.getElementById('preview_eye').style.border = "5px solid #000";
				  		document.getElementById('preview_skin').style.border = "5px solid #fff";
						document.getElementById('preview_hair').style.border = "5px solid #fff";
						eyeSelection = false;
					}
					break;
			  	} else { //already selected
			  		//turn off
			  	}
			}
		  case "preview_hair":
		  	//check whether another was activated or not
		  	if(!((document.getElementById('preview_eye').style.border === "5px solid #000" || document.getElementById('preview_eye').style.border === "5px solid rgb(0, 0, 0)") || (document.getElementById('preview_skin').style.border === "5px solid #000" || document.getElementById('preview_skin').style.border === "5px solid rgb(0, 0, 0)"))){ //black
			  	//check whether already activated or not
			  	if(document.getElementById('preview_hair').style.border === "" || document.getElementById('preview_hair').style.border === "5px solid #fff" || document.getElementById('preview_hair').style.border === "5px solid rgb(255, 255, 255)"){ //white
				  	//only allow adjustment when preview_hair and preview_skin were already set 
				  	if(skinSelection === true && hairSelection === true){
					  	//activate
						document.getElementById('preview_hair').style.border = "5px solid #000";
						document.getElementById('preview_eye').style.border = "5px solid #fff";
						document.getElementById('preview_skin').style.border = "5px solid #fff";
						hairSelection = false;
					}
					break;
				} else { //already selected
			  		//turn off
				}
			}
		  case "preview_skin":
		  	//check whether another was activated or not
		  	if(!((document.getElementById('preview_hair').style.border === "5px solid #000" || document.getElementById('preview_hair').style.border === "5px solid rgb(0, 0, 0)") || (document.getElementById('preview_eye').style.border === "5px solid #000" || document.getElementById('preview_eye').style.border === "5px solid rgb(0, 0, 0)"))){ //black
			  	//check whether already activated or not
			  	if(document.getElementById('preview_skin').style.border === "" || document.getElementById('preview_skin').style.border === "5px solid #fff" || document.getElementById('preview_skin').style.border === "5px solid rgb(255, 255, 255)"){ //white
			  		//only allow adjustment when preview_skin were already set
			  		if(skinSelection === true){
					  	//activate
				  		document.getElementById('preview_skin').style.border = "5px solid #000";
				  		document.getElementById('preview_hair').style.border = "5px solid #fff";
						document.getElementById('preview_eye').style.border = "5px solid #fff";
						skinSelection = false;
					}
					break;
				} else { //already selected
			  		//turn off
				}
			}
		  default:
		    // code block
		}
		
		//show 

	}

	_listener1 = function(e) { //click (end)
		//var tlength = e.touches.length;
		//document.getElementsByClassName("flyout-debug")[0].innerText = "CP added";
		//document.getElementsByClassName("preview_debug")[0].innerText = "TP: " + tlength.toString() + "";
		//document.getElementsByClassName("preview_debug_3")[0].innerText = "Click!";

		//detect drags --> PPPPPPPPPPE signature
		//document.getElementsByClassName("preview_debug_3")[0].innerText = cpsig2.slice(cpsig2.length - 15);


		//check whether we need to wait for the next user action to do something (e.g. click/tap) or not
		if(cpsig2.slice(cpsig2.length - 2) === "PE"){
			registerC = false;
			cpsig2 = []; //reset
		} else {
			registerC = true;
		}

		//console.log("click")
		//console.log(e)

		//console.log(e.srcElement)
		// chrome
		if(e.offsetX) {
			x = e.offsetX;
			y = e.offsetY; 
		}
		// firefox
		else if(e.layerX) {
			x = e.layerX;
			y = e.layerY;
		}
		useCanvas(inst.canvas, inst.img, function(){
			// get image data
			//console.log("Debug:")
			/*console.log("inst.img")
			console.log(inst.img);
			console.log("inst.canvas")
			console.log(inst.canvas);*/
			//console.log(inst.canvas.getContext('2d'))
			// https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas
			inst.result_rgb = inst.canvas.getContext('2d')
				.getImageData(x, y, 1, 1).data;
			
			var p = inst.result_rgb;
			
			// show info
			inst.result_hex = rgbToHex(p[0],p[1],p[2]);
			inst.result_rgb_string = 'rgb('+p[0]+','+ p[1]+','+ p[2]+')';
			
			// set value
			//console.log("skinSelection: ", skinSelection)
			if(skinSelection === false && registerC === true){
				//document.getElementById("preview_skin").style.background = rgbToHex(p[0],p[1],p[2]);
				document.getElementById("preview_skin").style.backgroundColor = rgbToHex(p[0],p[1],p[2]);
				document.getElementById("preview_skin").style.backgroundSize = "42.5px 42.5px"
				document.getElementById("preview_skin").style.backgroundImage = "url('https://static.wixstatic.com/media/3e929c_000c0389ad654985be5d7983694c7695~mv2.png')";
				document.getElementById("preview_skin").style.backgroundRepeat = "no-repeat"
				document.getElementById("preview_skin").style.backgroundPosition = "center 50%"
				skinSelection = true;
				document.getElementById('preview_skin').style.border = "5px solid #fff";
			} else {
				if(hairSelection === false && registerC === true){
					//document.getElementById("preview_hair").style.background = rgbToHex(p[0],p[1],p[2]);
					document.getElementById("preview_hair").style.backgroundColor = rgbToHex(p[0],p[1],p[2]);
					document.getElementById("preview_hair").style.backgroundSize = "42.5px 42.5px"
					document.getElementById("preview_hair").style.backgroundImage = "url('https://static.wixstatic.com/media/3e929c_cad76816bc4441b6bfe34f5008b2741d~mv2.png')";
					document.getElementById("preview_hair").style.backgroundRepeat = "no-repeat"
					document.getElementById("preview_hair").style.backgroundPosition = "center 50%"
					hairSelection = true;
					document.getElementById('preview_hair').style.border = "5px solid #fff"
				} else {
					if(eyeSelection === false && registerC === true) {
						//document.getElementById("preview_eye").style.background = rgbToHex(p[0],p[1],p[2]);
						document.getElementById("preview_eye").style.backgroundColor = rgbToHex(p[0],p[1],p[2]);
							document.getElementById("preview_eye").style.backgroundSize = "42.5px 42.5px"
							document.getElementById("preview_eye").style.backgroundImage = "url('https://static.wixstatic.com/media/3e929c_f628dfa5fe0a412da6f06954a8657458~mv2.png')";
							document.getElementById("preview_eye").style.backgroundRepeat = "no-repeat"
							document.getElementById("preview_eye").style.backgroundPosition = "center 50%"
						eyeSelection = true;
						document.getElementById('preview_eye').style.border = "5px solid #fff"
					}
				}

			}
			//console.log("R: " + p[0] + " - G: " + p[1] + " - B: " + p[2]);
		});
	}

	_listener2 = function(e) { //touchend

		//console.log(e)
		//document.getElementsByClassName("preview_debug_2")[0].innerText = e.toString();

		//e.offsetX = e.touches[0].pageX - e.touches[0].target.offsetLeft;     
		//e.offsetY = e.touches[0].pageY - e.touches[0].target.offsetTop;

		//e.changedTouches[0].pageX - e.changedTouches[0].target.offsetLeft;
		//e.changedTouches[0].pageY - e.changedTouches[0].target.offsetTop;

		//console.log(e.srcElement)
		tlength = e.touches.length;
		cpsig1 = cpsig1 + tlength.toString();
		
		//document.getElementsByClassName("flyout-debug")[0].innerText = tlength.toString();
		
		//document.getElementsByClassName("preview_debug")[0].innerText = tlength.toString();
		//document.getElementsByClassName("preview_debug")[0].innerText = "TE: " + tlength.toString() + "";
		//document.getElementsByClassName("preview_debug_3")[0].innerText = cpsig1.slice(cpsig1.length - 15);

		//var tmpvar = false;
		if(tlength === 0){
			//if(pan === true || zoom === true){ 
			/*if(tmpvar === true){
				document.getElementsByClassName("preview_debug_3")[0].innerText = "It #2: " + transform.toString();
			}*/

			if( (tf.x < -1E-9 || tf.x > 1E-9) || (tf.y < -1E-9 || tf.y > 1E-9) || tf.scale > 1){ //pan or zoom is true
				//document.getElementsByClassName("preview_debug_3")[0].innerText = "Zoomed: " + transform.toString();
				//activate CP again
				activateCP = true;
				//wait for the next user action to do something (e.g. click/tap)
				if(cpsig1.slice(cpsig1.length - 2) === "00"){
					registerC = true;
				} else {
					registerC = false;
				}
			} else { 
				//perform a check whether we came from a 'transformed' situation or not, in case yes, don't set the color.
				//document.getElementsByClassName("preview_debug_3")[0].innerText = "It #1: " + transform.toString();
				if(transform === true){ //we came from a 'transformed' situation
					registerC = false; //we wait for a user action
					transform = false;
					//tmpvar = true;
				} else { //register the underlying color that was touched before going to TE=0 and move to next color (registerC should be true here)
					//extra handle
					if(cpsig1.slice(cpsig1.length - 2) === "20"){
						registerC = false;
					} else {
						registerC = true;
					}
					
				}
			}

			
		}

		// chrome
		//if(e.offsetX) {
			//x = e.offsetX;
			//y = e.offsetY; 
		//}
		//x = e.changedTouches[0].pageX - e.changedTouches[0].target.offsetLeft
		//y = e.changedTouches[0].pageY - e.changedTouches[0].target.offsetTop;

		x = e.changedTouches[0].clientX - e.changedTouches[0].target.offsetLeft
		y = e.changedTouches[0].clientY - e.changedTouches[0].target.offsetTop;
		

		//e.changedTouches[0].pageX - e.changedTouches[0].target.offsetLeft;
		//e.changedTouches[0].pageY - e.changedTouches[0].target.offsetTop;

		// firefox
		/*else if(e.layerX) {
			x = e.layerX;
			y = e.layerY;
		}*/
		useCanvas(inst.canvas, inst.img, function(){
			// get image data
			//console.log("Debug:")
			/*console.log("inst.img")
			console.log(inst.img);
			console.log("inst.canvas")
			console.log(inst.canvas);*/
			//console.log(inst.canvas.getContext('2d'))
			//https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas

			var p = inst.canvas.getContext('2d')
				.getImageData(x, y, 1, 1).data;

			//console.log("p"); 
			//console.log(p); //wrong data
						
			// show info
			inst.result_hex = rgbToHex(p[0],p[1],p[2]);
			inst.result_rgb_string = 'rgb('+p[0]+','+ p[1]+','+ p[2]+')';
			
			// set value
			//console.log("skinSelection: ", skinSelection)
			if(skinSelection === false && tlength === 0 && registerC === true){
				//document.getElementById("preview_skin").style.background = rgbToHex(p[0],p[1],p[2]);
				document.getElementById("preview_skin").style.backgroundColor = rgbToHex(p[0],p[1],p[2]);
				document.getElementById("preview_skin").style.backgroundSize = "42.5px 42.5px"
				document.getElementById("preview_skin").style.backgroundImage = "url('https://static.wixstatic.com/media/3e929c_000c0389ad654985be5d7983694c7695~mv2.png')";
				document.getElementById("preview_skin").style.backgroundRepeat = "no-repeat"
				document.getElementById("preview_skin").style.backgroundPosition = "center 50%"
				skinSelection = true;
				document.getElementById('preview_skin').style.border = "5px solid #fff";
			} else {
				if(hairSelection === false && tlength === 0 && registerC === true){
					document.getElementById("preview_hair").style.backgroundColor = rgbToHex(p[0],p[1],p[2]);
					document.getElementById("preview_hair").style.backgroundSize = "42.5px 42.5px"
					document.getElementById("preview_hair").style.backgroundImage = "url('https://static.wixstatic.com/media/3e929c_cad76816bc4441b6bfe34f5008b2741d~mv2.png')";
					document.getElementById("preview_hair").style.backgroundRepeat = "no-repeat"
					document.getElementById("preview_hair").style.backgroundPosition = "center 50%"
					hairSelection = true;
					document.getElementById('preview_hair').style.border = "5px solid #fff"
				} else {
					if(eyeSelection === false && tlength === 0 && registerC === true){
						document.getElementById("preview_eye").style.backgroundColor = rgbToHex(p[0],p[1],p[2]);
						document.getElementById("preview_eye").style.backgroundSize = "42.5px 42.5px"
						document.getElementById("preview_eye").style.backgroundImage = "url('https://static.wixstatic.com/media/3e929c_f628dfa5fe0a412da6f06954a8657458~mv2.png')";
						document.getElementById("preview_eye").style.backgroundRepeat = "no-repeat"
						document.getElementById("preview_eye").style.backgroundPosition = "center 50%"
						eyeSelection = true;
						document.getElementById('preview_eye').style.border = "5px solid #fff"
					}
				}

			}
			//console.log("R: " + p[0] + " - G: " + p[1] + " - B: " + p[2]);
		});
	}

	_listener3 = function(e) { //mousemove
		// chrome
		if(e.offsetX) {
			x = e.offsetX;
			y = e.offsetY; 
		}
		// firefox
		else if(e.layerX) {
			x = e.layerX;
			y = e.layerY;
		}
		
		useCanvas(inst.canvas, inst.img, function(){
			// get image data
			//console.log("Debug:")
			/*console.log("inst.img")
			console.log(inst.img);
			console.log("inst.canvas")
			console.log(inst.canvas);*/
			//console.log(inst.canvas.getContext('2d'))
			// https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas
			var p = inst.canvas.getContext('2d')
				.getImageData(x, y, 1, 1).data;
			
			// show preview color
			//inst.preview.style.background = rgbToHex(p[0],p[1],p[2]);
			//console.log("skinSelection: ", skinSelection)
			if(skinSelection === false){
				document.getElementById("preview_skin").style.backgroundColor = rgbToHex(p[0],p[1],p[2]);
				document.getElementById("preview_skin").style.backgroundSize = "42.5px 42.5px"
				document.getElementById("preview_skin").style.backgroundImage = "url('https://static.wixstatic.com/media/3e929c_000c0389ad654985be5d7983694c7695~mv2.png')";
				document.getElementById("preview_skin").style.backgroundRepeat = "no-repeat"
				document.getElementById("preview_skin").style.backgroundPosition = "center 50%"
			} else {
				if(hairSelection === false){
					document.getElementById("preview_hair").style.backgroundColor = rgbToHex(p[0],p[1],p[2]);
					document.getElementById("preview_hair").style.backgroundSize = "42.5px 42.5px"
					document.getElementById("preview_hair").style.backgroundImage = "url('https://static.wixstatic.com/media/3e929c_cad76816bc4441b6bfe34f5008b2741d~mv2.png')";
					document.getElementById("preview_hair").style.backgroundRepeat = "no-repeat"
					document.getElementById("preview_hair").style.backgroundPosition = "center 50%"
				} else {
					if(eyeSelection === false){
						document.getElementById("preview_eye").style.backgroundColor = rgbToHex(p[0],p[1],p[2]);
						document.getElementById("preview_eye").style.backgroundSize = "42.5px 42.5px"
						document.getElementById("preview_eye").style.backgroundImage = "url('https://static.wixstatic.com/media/3e929c_f628dfa5fe0a412da6f06954a8657458~mv2.png')";
						document.getElementById("preview_eye").style.backgroundRepeat = "no-repeat"
						document.getElementById("preview_eye").style.backgroundPosition = "center 50%"
					}
				}

			}
			//console.log("R: " + p[0] + " - G: " + p[1] + " - B: " + p[2]);
		});
	}

	_listener4 = function(e) { //touchmove

		tlength = e.touches.length; //get number of touch points (1)
		cpsig1 = cpsig1 + tlength.toString();
		//document.getElementsByClassName("flyout-debug")[0].innerText = tlength.toString();
		//document.getElementsByClassName("preview_debug")[0].innerText = tlength.toString();
		//document.getElementsByClassName("preview_debug")[0].innerText = "TM: " + tlength.toString() + "";
		//document.getElementsByClassName("preview_debug_3")[0].innerText = cpsig1.slice(cpsig1.length - 15);

		//if(pan === true || zoom === true){
		if( (tf.x < -1E-9 || tf.x > 1E-9) || (tf.y < -1E-9 || tf.y > 1E-9) || tf.scale > 1){ //pan or zoom is true
			if(tlength === 2 || tlength === 1){
				activateCP = false; //activate again when TE = 0
				registerC = false;
			}
		} else { //if not zoomed/panned
			//show color on tm=1 (here)
			activateCP = true;
			
		}
		

		// chrome
		/*if(e.offsetX) {
			x = e.offsetX;
			y = e.offsetY; 
		}
		// firefox
		else if(e.layerX) {
			x = e.layerX;
			y = e.layerY;
		}*/

		//x = e.changedTouches[0].pageX - e.changedTouches[0].target.offsetLeft
		//y = e.changedTouches[0].pageY - e.changedTouches[0].target.offsetTop;

		x = e.changedTouches[0].clientX - e.changedTouches[0].target.offsetLeft
		y = e.changedTouches[0].clientY - e.changedTouches[0].target.offsetTop;
		
		useCanvas(inst.canvas, inst.img, function(){
			// get image data
			//console.log("Debug:")
			/*console.log("inst.img")
			console.log(inst.img);
			console.log("inst.canvas")
			console.log(inst.canvas);*/
			//console.log(inst.canvas.getContext('2d'))
			// https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas
			var p = inst.canvas.getContext('2d')
				.getImageData(x, y, 1, 1).data;

			//document.getElementsByClassName("flyout-debug")[0].innerText = p.toString();
			
			// show preview color
			//inst.preview.style.background = rgbToHex(p[0],p[1],p[2]);
			//console.log("skinSelection: ", skinSelection)
			if(activateCP === true && skinSelection === false && tlength === 1){
				document.getElementById("preview_skin").style.background = rgbToHex(p[0],p[1],p[2]);
				document.getElementById("preview_skin").style.backgroundSize = "42.5px 42.5px"
				document.getElementById("preview_skin").style.backgroundImage = "url('https://static.wixstatic.com/media/3e929c_000c0389ad654985be5d7983694c7695~mv2.png')";
				document.getElementById("preview_skin").style.backgroundRepeat = "no-repeat"
				document.getElementById("preview_skin").style.backgroundPosition = "center 50%"
			} else {
				if(activateCP === true && hairSelection === false && tlength === 1){
					document.getElementById("preview_hair").style.background = rgbToHex(p[0],p[1],p[2]);
					document.getElementById("preview_hair").style.backgroundSize = "42.5px 42.5px"
					document.getElementById("preview_hair").style.backgroundImage = "url('https://static.wixstatic.com/media/3e929c_cad76816bc4441b6bfe34f5008b2741d~mv2.png')";
					document.getElementById("preview_hair").style.backgroundRepeat = "no-repeat"
					document.getElementById("preview_hair").style.backgroundPosition = "center 50%"
					
				} else {
					if(activateCP === true && eyeSelection === false && tlength === 1){
						document.getElementById("preview_eye").style.background = rgbToHex(p[0],p[1],p[2]);
						document.getElementById("preview_eye").style.backgroundSize = "42.5px 42.5px"
						document.getElementById("preview_eye").style.backgroundImage = "url('https://static.wixstatic.com/media/3e929c_f628dfa5fe0a412da6f06954a8657458~mv2.png')";
						document.getElementById("preview_eye").style.backgroundRepeat = "no-repeat"
						document.getElementById("preview_eye").style.backgroundPosition = "center 50%"
					}
				}

			}
			//console.log("R: " + p[0] + " - G: " + p[1] + " - B: " + p[2]);
		});
	}

	function resetZoom(panZoomInstance) {
	  instance.moveTo(0, 0);
	  instance.zoomAbs(0, 0, 1);
	}

	_reset = function(e) {

		document.getElementById("preview_eye").style.background = "";
		document.getElementById("preview_hair").style.background = "";
		document.getElementById("preview_skin").style.background = "";
		document.getElementById("preview_eye").style.border = "5px solid rgb(255, 255, 255)";
		document.getElementById("preview_hair").style.border = "5px solid rgb(255, 255, 255)";
		document.getElementById("preview_skin").style.border = "5px solid rgb(255, 255, 255)";
		skinSelection = false;
		hairSelection = false;
		eyeSelection = false;
		resetZoom(instance);
	}

	_gestures = function(e) {

		var el = document.getElementById('message');
		if (typeof(el) != 'undefined' && el != null) { //exists
			if(el.innerText === "Spread-to-zoom"){
				el.remove();
			} else {
				el.innerText = "Spread-to-zoom";
				var icon_delete = document.createElement("img");
				icon_delete.setAttribute("class", "icon_delete");
	  			icon_delete.setAttribute("src", "https://static.wixstatic.com/media/e3157a_ed2814b14577454c93c57b77ab73c492~mv2.png");
	  			icon_delete.setAttribute("width", "15");
	  			icon_delete.setAttribute("height", "15");
	    		el.appendChild(icon_delete);
	    		var del = document.querySelector(".icon_delete")
				del.addEventListener("click", _delmessage, false);

			}
		  
		} else {
			var msg = document.createElement('div'); 
			msg.className = 'message';
			msg.id = 'message';
			msg.innerText = 'Spread-to-zoom';
			document.querySelector('body').insertBefore(msg, document.querySelector('body').children[1]);

			var icon_delete = document.createElement("img");
			icon_delete.setAttribute("class", "icon_delete");
  			icon_delete.setAttribute("src", "https://static.wixstatic.com/media/e3157a_ed2814b14577454c93c57b77ab73c492~mv2.png");
  			icon_delete.setAttribute("width", "15");
  			icon_delete.setAttribute("height", "15");
    		msg.appendChild(icon_delete);
    		var del = document.querySelector(".icon_delete")
			del.addEventListener("click", _delmessage, false);
		}
	}

	_gesturet = function(e) {
		var el = document.getElementById('message');
		if (typeof(el) != 'undefined' && el != null) { //exists
			if(el.innerText === "Tap to select, adjust or delete"){
				el.remove();
			} else {
				el.innerText = "Tap to select, adjust or delete";
				var icon_delete = document.createElement("img");
				icon_delete.setAttribute("class", "icon_delete");
	  			icon_delete.setAttribute("src", "https://static.wixstatic.com/media/e3157a_ed2814b14577454c93c57b77ab73c492~mv2.png");
	  			icon_delete.setAttribute("width", "15");
	  			icon_delete.setAttribute("height", "15");
	    		el.appendChild(icon_delete);
	    		var del = document.querySelector(".icon_delete")
				del.addEventListener("click", _delmessage, false);
			}
		  
		} else {
			var msg = document.createElement('div'); 
			msg.className = 'message';
			msg.id = 'message';
			msg.innerText = 'Tap to select, adjust or delete';
			document.querySelector('body').insertBefore(msg, document.querySelector('body').children[1]);

			var icon_delete = document.createElement("img");
			icon_delete.setAttribute("class", "icon_delete");
  			icon_delete.setAttribute("src", "https://static.wixstatic.com/media/e3157a_ed2814b14577454c93c57b77ab73c492~mv2.png");
  			icon_delete.setAttribute("width", "15");
  			icon_delete.setAttribute("height", "15");
    		msg.appendChild(icon_delete);
    		var del = document.querySelector(".icon_delete")
			del.addEventListener("click", _delmessage, false);
		}
		
	}

	_delmessage = function(e) {
		//console.log(e)
		e.target.parentElement.remove();
	}

	function componentToHex(c) {
		var hex = c.toString(16);
		return hex.length == 1 ? "0" + hex : hex;
	}

	function rgbToHex(r, g, b) {
		return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
	}

	

	


	
</script>

</body>
</html>
